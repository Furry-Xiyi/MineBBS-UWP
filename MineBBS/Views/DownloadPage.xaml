<Page
    x:Class="MineBBS.Views.DownloadPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:muxc="using:Microsoft.UI.Xaml.Controls"
    xmlns:converters="using:MineBBS.Converters"
    xmlns:local="using:MineBBS.Views">

    <Page.Resources>
        <Style x:Key="CardBorderStyle" TargetType="Border">
            <Setter Property="CornerRadius" Value="10"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Padding" Value="0"/>
            <Setter Property="Margin" Value="0,0,0,14"/>
            <Setter Property="BorderBrush" Value="{ThemeResource SystemControlBackgroundBaseLowBrush}"/>
            <Setter Property="Background" Value="{ThemeResource SystemControlAcrylicWindowBrush}"/>
        </Style>
        <Style x:Key="VersionTitleStyle" TargetType="TextBlock">
            <Setter Property="FontSize" Value="20"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
        </Style>
        <Style x:Key="SubInfoStyle" TargetType="TextBlock">
            <Setter Property="FontSize" Value="12"/>
            <Setter Property="Foreground" Value="{ThemeResource SystemControlForegroundBaseMediumBrush}"/>
        </Style>
        <converters:BooleanToVisibilityConverter x:Key="BoolToVis"/>
    </Page.Resources>

    <Grid>
        <ScrollViewer>
            <StackPanel Margin="20">
                <TextBlock Text="Minecraft 下载中心"
                           FontSize="28"
                           FontWeight="Bold"
                           Foreground="{ThemeResource AccentTextFillColorPrimaryBrush}"/>
                <TextBlock x:Name="StatusText"
                           Style="{StaticResource SubInfoStyle}"
                           Margin="0,6,0,20"
                           Text="正在获取最新版本列表…"/>

                <ListView x:Name="VersionList"
                          SelectionMode="None"
                          IsItemClickEnabled="False">
                    <ListView.ItemContainerStyle>
                        <Style TargetType="ListViewItem">
                            <Setter Property="HorizontalContentAlignment" Value="Stretch"/>
                            <Setter Property="Padding" Value="0"/>
                            <Setter Property="Margin" Value="0"/>
                        </Style>
                    </ListView.ItemContainerStyle>
                    <ListView.ItemTemplate>
                        <DataTemplate>
                            <Border Style="{StaticResource CardBorderStyle}">
                                <muxc:Expander HorizontalAlignment="Stretch"
                                               HorizontalContentAlignment="Stretch">
                                    <!-- 封面：Header -->
                                    <muxc:Expander.Header>
                                        <Grid Height="60" Padding="16,8">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="Auto"/>
                                            </Grid.ColumnDefinitions>

                                            <!-- 左侧：版本号和信息 -->
                                            <StackPanel Grid.Column="0" VerticalAlignment="Center">
                                                <TextBlock Text="{Binding Version}" 
                                                           Style="{StaticResource VersionTitleStyle}"/>
                                                <TextBlock Style="{StaticResource SubInfoStyle}" Margin="0,4,0,0">
                                                    <Run Text="{Binding Date}"/>
                                                    <Run Text=" | "/>
                                                    <Run Text="{Binding Downloads}"/>
                                                    <Run Text=" 次下载"/>
                                                </TextBlock>
                                            </StackPanel>

                                            <!-- 右侧：文件大小 -->
                                            <TextBlock Grid.Column="1" 
                                                       Text="{Binding Size}" 
                                                       FontSize="14" 
                                                       FontWeight="Medium"
                                                       VerticalAlignment="Center"/>
                                        </Grid>
                                    </muxc:Expander.Header>

                                    <!-- 展开内容：更新日志 + 按钮 -->
                                    <Grid Padding="16">
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="*"/>
                                            <RowDefinition Height="Auto"/>
                                        </Grid.RowDefinitions>

                                        <!-- 更新日志 -->
                                        <ScrollViewer Grid.Row="0" 
                                                      MaxHeight="300" 
                                                      VerticalScrollBarVisibility="Auto"
                                                      Margin="0,0,0,12">
                                            <TextBlock Text="{Binding Description}" 
                                                       TextWrapping="Wrap"/>
                                        </ScrollViewer>

                                        <!-- 按钮区域（右下角） -->
                                        <StackPanel Grid.Row="1" 
            Orientation="Horizontal" 
            HorizontalAlignment="Right"
            Spacing="8">

                                            <!-- 查看详情按钮：绿色背景 + 图标 -->
                                            <Button Tag="{Binding DetailUrl}" 
            Click="DetailButton_Click"
            Background="#189F58">
                                                <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                                                    <FontIcon Glyph="&#xE8A5;" Margin="0,0,6,0"/>
                                                    <!-- info 图标 -->
                                                    <TextBlock Text="查看详情"/>
                                                </StackPanel>
                                            </Button>

                                            <!-- 分享按钮：浅棕色背景 + 图标 -->
                                            <Button Tag="{Binding ShareUrl}" 
            Click="ShareButton_Click"
            Background="#F0A020">
                                                <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                                                    <FontIcon Glyph="&#xE72D;" Margin="0,0,6,0"/>
                                                    <!-- 分享图标 -->
                                                    <TextBlock Text="分享"/>
                                                </StackPanel>
                                            </Button>

                                            <!-- 下载按钮：系统主题色 + 图标 -->
                                            <Button Style="{StaticResource AccentButtonStyle}">
                                                <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                                                    <FontIcon Glyph="&#xE896;" Margin="0,0,6,0"/>
                                                    <!-- 下载图标 -->
                                                    <TextBlock Text="下载"/>
                                                </StackPanel>
                                                <Button.Flyout>
                                                    <MenuFlyout Placement="Bottom">
                                                        <MenuFlyoutItem Text="完整版本" 
                                Tag="{Binding DownloadUrl}" 
                                Click="DownloadPrimary_Click"/>
                                                        <MenuFlyoutItem Text="备用通道" 
                                Tag="{Binding MirrorUrl}" 
                                Click="DownloadMirror_Click"
                                Visibility="{Binding HasMirrorUrl, Converter={StaticResource BoolToVis}}"/>
                                                    </MenuFlyout>
                                                </Button.Flyout>
                                            </Button>
                                        </StackPanel>
                                    </Grid>
                                </muxc:Expander>
                            </Border>
                        </DataTemplate>
                    </ListView.ItemTemplate>
                </ListView>
                <Button x:Name="LoadMoreButton"
                        Content="加载更多"
                        HorizontalAlignment="Center"
                        Margin="0,10,0,0"
                        Visibility="Collapsed"
                        Click="LoadMoreButton_Click"/>
            </StackPanel>
        </ScrollViewer>
    </Grid>
</Page>